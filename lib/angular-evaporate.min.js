!function(e,n){"use strict";e.module("evaporate",[]).directive("evaporate",["$timeout",function(t){function o(e,n,t){if(!e||"object"!=typeof e)throw"invalid configInit";if(!e.bucket)throw"missing configInit.bucket";if(!e.aws_key)throw"missing configInit.aws_key";if(!e.signerUrl)throw"missing configInit.signerUrl";if(!n||"object"!=typeof n)throw"invalid configAdd";if(!t||"object"!=typeof t)throw"invalid configName";t.bucketUrl||(t.bucketUrl=(e.aws_url||"https://s3.amazonaws.com")+"/"+e.bucket+"/"),t.directoryName||(t.directoryName=""),t.timestampSeparator||(t.timestampSeparator="-"),t.useTimestamp||t.useFilename||(t.useTimestamp=!0)}function i(e,n,t){var o=t.directoryName;return t.useTimestamp&&(o+=n),t.useTimestamp&&t.useFilename&&(o+=t.timestampSeparator),t.useFilename&&(o+=e),o}function c(e,n){var t=Array.prototype.slice.call(e);return t.unshift(n),t}function a(a,r){r.unbind("change");try{o(a.configInit,a.configAdd,a.configName)}catch(f){return void(console&&console.error&&console.error("ERROR @ angular-evaporate:",f))}a.model||(a.model={});var d=new n(a.configInit);a.model.supported=d.supported,d.supported&&r.bind("change",function(n){a.model.files=[],e.forEach(n.target.files,function(n){n.started=Date.now(),n.bucketUrl=a.configName.bucketUrl,n.bucketPath=i(n.name,n.started,a.configName),n.url=n.bucketUrl+n.bucketPath;var o=d.add(e.extend({},{name:n.bucketPath,file:n,contentType:n.type||"binary/octet-stream"},a.configAdd,{complete:function(){n.complete=!0,"function"==typeof a.configAdd.complete&&a.configAdd.complete.apply(this,c(arguments,n)),t(a.$apply.bind(a))},cancelled:function(){n.cancelled=!0,"function"==typeof a.configAdd.cancelled&&a.configAdd.cancelled.apply(this,c(arguments,n)),t(a.$apply.bind(a))},info:function(e){n.info=e,"function"==typeof a.configAdd.info&&a.configAdd.info.apply(this,c(arguments,n)),t(a.$apply.bind(a))},warn:function(e){n.warn=e,"function"==typeof a.configAdd.warn&&a.configAdd.warn.apply(this,c(arguments,n)),t(a.$apply.bind(a))},error:function(e){n.error=e,"function"==typeof a.configAdd.error&&a.configAdd.error.apply(this,c(arguments,n)),t(a.$apply.bind(a))},progress:function(e){n.progress=Math.round(1e4*e)/100,n.timeLeft=Math.round((100-n.progress)/n.progress*((Date.now()-n.started)/1e3)),"function"==typeof a.configAdd.progress&&a.configAdd.progress.apply(this,c(arguments,n)),t(a.$apply.bind(a))}}));n.cancel=d.cancel.bind(d,o),a.model.files.push(n)}),t(a.$apply.bind(a))})}function r(e,n){var t=function(t,o){o!==t&&a(e,n)};e.$watch("configInit",t,!0),e.$watch("configAdd",t,!0),e.$watch("configName",t,!0),a(e,n)}return{restrict:"A",scope:{configInit:"=evaConfigInit",configAdd:"=evaConfigAdd",configName:"=evaConfigName",model:"=evaModel"},link:r}}])}(angular,Evaporate);